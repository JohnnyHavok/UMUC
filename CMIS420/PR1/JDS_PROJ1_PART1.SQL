/* 
**  Author: Justin Smith
**  Course: CMIS 420.7980
**  Date:  04/05/14
**  Project 1 - Part 1
*/


-- Problem 1
CREATE VIEW BUSY_STUDENT
AS SELECT (First_Name || ' ' || Last_Name) AS FULL_NAME, S.Student_ID, E.ENROLL_NUM 
  FROM STUDENT S JOIN 
  (
    SELECT Student_ID, COUNT(Student_ID) AS ENROLL_NUM
      FROM ENROLLMENT
      HAVING COUNT(Student_ID) > 2
      GROUP BY Student_ID
  ) E ON S.Student_ID = E.Student_ID;


-- Problem 2
-- Create Table with Constraints
CREATE TABLE TEMP_STUDENT
( 
  STUD_ID NUMBER(8) NOT NULL,
  FIRST_NAME VARCHAR2(25),
  LAST_NAME VARCHAR2(25),
  ZIP VARCHAR2(5),
  REGISTRATION_DATE DATE NOT NULL,
  CONSTRAINT TEMP_STUDENT_PK PRIMARY KEY (STUD_ID),
  CONSTRAINT ZIP_ZIPCODE_FK FOREIGN KEY (ZIP) REFERENCES ZIPCODE(ZIP),
  CONSTRAINT REGISTRATION_DATE_CHECK CHECK
    (REGISTRATION_DATE > TO_DATE('26-AUG-2005','DD-MON-YYYY'))
);

-- Violates REGISTRATION_DATE NOT NULL
INSERT INTO TEMP_STUDENT (STUD_ID, FIRST_NAME, LAST_NAME, ZIP)
VALUES (1234, 'Justin', 'Smith', '22485');

-- Violates REGISTRATION_DATE BEFORE 26-AUG-2005
INSERT INTO TEMP_STUDENT (STUD_ID, FIRST_NAME, LAST_NAME, ZIP, REGISTRATION_DATE)
VALUES (1234, 'Justin', 'Smith', '22485', TO_DATE('12-AUG-2005', 'DD-MON-YYYY'));

-- Violates ZIPCODE.ZIP FK Reference
INSERT INTO TEMP_STUDENT (STUD_ID, FIRST_NAME, LAST_NAME, ZIP, REGISTRATION_DATE)
VALUES (1234, 'Justin', 'Smith', '22485', TO_DATE('27-AUG-2005', 'DD-MON-YYYY'));

-- Three TEMP_STUDENT records will be added sucessfully
INSERT INTO TEMP_STUDENT (STUD_ID, FIRST_NAME, LAST_NAME, ZIP, REGISTRATION_DATE)
VALUES (1234, 'Justin', 'Smith', '02189', TO_DATE('27-AUG-2005', 'DD-MON-YYYY'));

INSERT INTO TEMP_STUDENT (STUD_ID, FIRST_NAME, LAST_NAME, ZIP, REGISTRATION_DATE)
VALUES (1235, 'Sarah', 'Johnson', '07021', TO_DATE('28-AUG-2005', 'DD-MON-YYYY'));

INSERT INTO TEMP_STUDENT (STUD_ID, FIRST_NAME, LAST_NAME, ZIP, REGISTRATION_DATE)
VALUES (1236, 'Steven', 'Edwards', '07021', TO_DATE('28-AUG-2005', 'DD-MON-YYYY'));
